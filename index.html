<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nascondi Parole — Semplice</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:20px;background:#f7f7fb;color:#111}
    .app{max-width:720px;margin:0 auto}
    h1{font-size:20px;margin-bottom:6px}
    p{margin-top:0;color:#444}
    .box{background:white;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(20,20,40,0.06)}
    #typing{width:100%;height:120px;border:1px dashed #ddd;border-radius:8px;padding:12px;font-size:16px;resize:none}
    .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    button{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;box-shadow:0 6px 12px rgba(20,20,40,0.06)}
    button.primary{background:#0b84ff;color:white}
    button.secondary{background:#f0f3f6}
    .note{font-size:13px;color:#666;margin-top:10px}
    .reveal{margin-top:14px;padding:12px;border-radius:8px;background:#fffbe6;border:1px solid #fde7a8;white-space:pre-wrap}
    .footer{font-size:13px;color:#666;margin-top:8px}
  </style>
</head>
<body>
  <div id="nameScreen" class="box" style="max-width:400px;margin:40px auto;text-align:center;">
    <h2>Inserisci qui il tuo nome :)</h2>
    <input id="userName" type="text" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;font-size:16px;">
    <button id="startBtn" class="primary" style="margin-top:12px;width:100%;">Inizia</button>
  </div>

  <div id="editorArea" style="display:none;">
    <div class="app">
      <h1>Nascondi parole mentre scrivi</h1>
      <p>Digita nel riquadro. Ogni volta che premi <strong>barra spaziatrice</strong> la parola appena completata verrà nascosta. Premi <strong>Ho finito</strong> per rivelare tutto quello che hai scritto.</p>

      <div class="box">
        <textarea id="typing" placeholder="Inizia a scrivere..." ></textarea>

        <div class="controls">
          <button id="emailBtn" class="secondary">Invia email</button>
          <button id="finishBtn" class="primary">Ho finito</button>
          <button id="undoBtn" class="secondary">Annulla ultima</button>
          <button id="resetBtn" class="secondary">Resetta</button>
        </div>

        <div class="note">Parole nascoste: <span id="hiddenCount">0</span></div>

        <div id="revealArea" class="reveal" style="display:none"></div>
        <div class="footer">Consiglio: scrivi normalmente. Se vuoi inserire uno spazio senza nascondere la parola, premi <em>Shift + Spazio</em>.</div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const ta = document.getElementById('typing');
      const finishBtn = document.getElementById('finishBtn');
      const emailBtn = document.getElementById('emailBtn');
      const undoBtn = document.getElementById('undoBtn');
      const resetBtn = document.getElementById('resetBtn');
      const hiddenCount = document.getElementById('hiddenCount');
      const revealArea = document.getElementById('revealArea');

      const startBtn = document.getElementById('startBtn');
      const userNameInput = document.getElementById('userName');
      const nameScreen = document.getElementById('nameScreen');
      const editorArea = document.getElementById('editorArea');

      let savedName = '';
      let allWords = [];

      function splitWords(text){
        return text.split(/\s+/).filter(Boolean);
      }

      function updateHiddenCount(){
        hiddenCount.textContent = allWords.length;
      }

      // Space key hides last word (unless Shift is held)
      ta.addEventListener('keydown', function(e){
        if(e.key === ' ' && !e.shiftKey){
          e.preventDefault();
          const text = ta.value;
          const parts = text.match(/(\S+)\s*$/);
          const lastWord = parts ? parts[1] : '';
          if(lastWord){
            allWords.push(lastWord);
            // remove the last word and trailing spaces
            ta.value = text.slice(0, text.length - lastWord.length).replace(/\s+$/,'');
            updateHiddenCount();
          }
        }
      });

      // Finish -> reveal full text (hidden + current)
      finishBtn.addEventListener('click', function(){
        const current = ta.value.trim();
        const currentWords = current ? splitWords(current) : [];
        const fullText = allWords.concat(currentWords).join(' ');
        revealArea.style.display = 'block';
        revealArea.textContent = fullText || '(vuoto)';
      });

      // Email -> opens mail client with full text
      emailBtn.addEventListener('click', function(){
        const current = ta.value.trim();
        const currentWords = current ? splitWords(current) : [];
        const fullText = allWords.concat(currentWords).join(' ');
        const today = new Date().toISOString().split('T')[0];
        const subject = `proiettivo scrittura - ${savedName || ''} - ${today}`;
        const mail = 'mailto:marcocarniel94@gmail.com?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(fullText);
        window.location.href = mail;
      });

      // Undo last hidden word
      undoBtn.addEventListener('click', function(){
        if(allWords.length === 0) return;
        const w = allWords.pop();
        ta.value = (ta.value ? ta.value + ' ' : '') + w + ' ';
        ta.focus();
        updateHiddenCount();
        revealArea.style.display = 'none';
      });

      // Reset app
      resetBtn.addEventListener('click', function(){
        if(!confirm('Resetta tutto? Le parole nascoste andranno perse dalla vista.')) return;
        allWords = [];
        ta.value = '';
        revealArea.style.display = 'none';
        updateHiddenCount();
      });

      // Start: collect name and show editor
      startBtn.addEventListener('click', function(){
        savedName = userNameInput.value.trim();
        if(!savedName) return alert('Inserisci un nome per continuare');
        nameScreen.style.display = 'none';
        editorArea.style.display = 'block';
        ta.focus();
      });

      // Initialize
      updateHiddenCount();
    })();
  </script>
</body>
</html>